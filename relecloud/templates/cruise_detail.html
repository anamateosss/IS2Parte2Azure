{% extends 'base.html' %}

{% block title %}
ReleCloud - {{ cruise }}
{% endblock %}

{% block content %}
<h1>{{ cruise }}</h1>
<p>
{{ cruise.description }}
</p>

<p>You can go on the cruise {{ cruise }} to the following planets:</p>
<ul class="list-group">
    {% for destination in cruise.destinations.all %}
        <a class="list-group-item list-group-item-action" href="{% url 'destination_detail' destination.id %}">{{ destination }}</a>
    {% empty %}
        <li class="list-group-item">No destinations currently available for this cruise.</li>
    {% endfor %}
</ul>

<!-- PT3: Opiniones -->
<hr class="my-4">
<h3>Opiniones</h3>

<p>
    ⭐ {{ avg_rating|floatformat:1 }} ({{ reviews|length }} opiniones)
</p>

{% if user.is_authenticated %}
    {% if not has_purchased %}
        <a class="btn btn-success" href="{% url 'purchase_cruise' cruise.id %}">Comprar</a>
    {% endif %}

    {% if can_review %}
        <a class="btn btn-secondary" href="{% url 'cruise_review_create' cruise.id %}">
            Escribir opinión
        </a>
    {% elif already_reviewed %}
        <p class="mt-2"><em>Ya has dejado una opinión.</em></p>
    {% endif %}
{% else %}
    <a href="{% url 'login' %}?next={{ request.path }}">Inicia sesión para comprar/opinar</a>
{% endif %}

<div class="mt-3">
    {% for r in reviews %}
        <div class="py-2 border-bottom">
            <strong>{{ r.user.username }}</strong> — {{ r.rating }}/5
            {% if r.comment %}
                <p class="mb-0">{{ r.comment }}</p>
            {% endif %}
        </div>
    {% empty %}
        <p>Sin opiniones todavía.</p>
    {% endfor %}
</div>

{% endblock content %}